	ORG	3000H
	LXI	SP,8000H
	JMP	START
EXIT:	JMP	0
TLEVLS:	DW	3400H
	SHLD	LEVLS
	JMP	LEVEL
GAME:	EQU	1D00H
COPY:	EQU	GAME+6
PALET0:	DB 0,192,7,12,197,34,54,-1,-1,-1,-1,-1,-1,-1,-1,-1
LEVLS:	DW	0
WLEVL:	DB	0
LPOINT:	DB	0
MARK:	DB	0
PODL:	DB	0
WMINA:	DB	0
WBABCH:	DB	0
WBOLD:	DB	0
START:	CALL	INIT
	LXI	D,PALET0
	CALL	SCR0
	LXI	H,PUSTP
	XRA	A
ST10:	MOV	M,A
	INR	L
	JNZ	ST10
	MVI	A,1
	STA	WLEVL
	MVI	A,0FH
	CALL	SCR2
BEGI0:	MVI	C,0DH
	CALL	PRINTC
	MVI	C,1FH
	CALL	PRINTC
	CALL	LEVS
	MVI	A,76H
	STA	MARK
	XRA	A
	STA	WMINA
	STA	WBABCH
	STA	WBOLD
	CALL	LEVEL
BEGIN:	LDA	MARK
	CALL	M1E
	STA	PODL
	LDA	MARK
	CALL	M20
	LXI	D,0E000H
	DAD	D
	LXI	D,MARKP
	CALL	M23
BEG10:	CALL	INKEY
	CPI	0FFH
	JZ	BEG10
	CPI	03H
	JZ	EXIT
	MVI	B,01H
	CPI	08H
	JZ	M28
	MVI	B,02H
	CPI	18H
	JZ	M28
	MVI	B,03H
	CPI	19H
	JZ	M28
	MVI	B,04H
	CPI	1AH
	JZ	M28
	CPI	02H
	JZ	INCLEV
	CPI	1BH
	JZ	DECLEV
	CPI	20H
	JZ	M2B
	SUI	30H
	JM	BEG10
	CPI	08H
	JNC	BEG10
	CALL	M2C
	PUSH	PSW
	MOV	B,A
	LDA	MARK
	CALL	M2D
	CALL	M20
	PUSH	H
	LXI	D,0E000H
	DAD	D
	LXI	D,PUSTP
	CALL	M23
	POP	H
	POP	PSW
	CALL	M2F
	CALL	COPY
	JMP	BEGIN
M2C:	CPI	04H
	RNC
	PUSH	PSW
	ANA	A
	JZ	M32
	DCR	A
	JZ	M33
	DCR	A
	JZ	M34
	LDA	WMINA
	CPI	21H
	JNC	M35
	INR	A
	STA	WMINA
	POP	PSW
	RET
M35:	POP	H
	POP	H
	JMP	BEG10
M33:	LDA	WBOLD
	ANA	A
	JNZ	M35
	INR	A
	STA	WBOLD
	POP	PSW
	RET
M34:	LDA	WBABCH
	CPI	21H
	JNC	M35
	INR	A
	STA	WBABCH
	POP	PSW
	RET
M32:	LDA	MARK
	CALL	M1E
	CPI	04H
	JNC	M36
	ANA	A
	JZ	M36
	DCR	A
	JZ	M37
	DCR	A
	JZ	M38
	LDA	WMINA
	DCR	A
	STA	WMINA
M36:	POP	PSW
	RET
M37:	STA	WBOLD
	POP	PSW
	RET
M38:	LDA	WBABCH
	DCR	A
	STA	WBABCH
	POP	PSW
	RET
INCLEV:	LXI	H,WLEVL
	INR	M
	MOV	A,M
	CPI	65
	JC	BEGI0
	MVI	M,1
	JMP	BEGI0
DECLEV:	LXI	H,WLEVL
	DCR	M
	JNZ	BEGI0
	MVI	M,64
	JMP	BEGI0
M2B:	LHLD	LEVLS
	XCHG
	LXI	H,OLEVEL
	XRA	A
	STA	LPOINT
	MVI	B,10H
M3F:	MVI	C,10H
M3E:	CALL	M3D
	INX	H
	DCR	C
	JNZ	M3E
	DCR	B
	JNZ	M3F
	JMP	BEGI0
M3D:	LDA	LPOINT
	ANA	A
	JNZ	M40
	INR	A
	STA	LPOINT
	MOV	A,M
	RRC
	RRC
	RRC
	RRC
	STAX	D
	RET
M40:	DCR	A
	STA	LPOINT
	LDAX	D
	ORA	M
	STAX	D
	INX	D
	RET
M28:	LDA	MARK
	MOV	C,A
	CALL	M41
	JNZ	BEG10
	MOV	A,C
	ADD	B
	STA	MARK
	MOV	A,C
	CALL	M20
	PUSH	H
	LXI	D,0E000H
	DAD	D
	LXI	D,PUSTP
	CALL	M23
	POP	H
	LDA	PODL
	CALL	M2F
	CALL	COPY
	JMP	BEGIN
M2F:	DCR	A
	JZ	M42
	DCR	A
	JZ	M43
	DCR	A
	JZ	M44
	DCR	A
	JZ	M45
	DCR	A
	JZ	M46
	DCR	A
	JZ	M47
	DCR	A
	JZ	M48
	LXI	D,PUSTP
	RET
M42:	LXI	D,BOLDRP
	RET
M43:	LXI	D,BABCHP
	RET
M44:	LXI	D,MINAP
	RET
M45:	LXI	D,KAMENP
	RET
M46:	LXI	D,ALMAZP
	RET
M47:	LXI	D,STENP
	RET
M48:	LXI	D,ZEMLAP
	RET
LEVEL:	LHLD	LEVLS
	XCHG
	LXI	H,VIDEO
	XRA	A
	STA	LPOINT
	MVI	B,10H
M5B:	MVI	C,10H
	PUSH	H
M59:	CALL	M51
	PUSH	D
	DCR	A
	JZ	M52
	DCR	A
	JZ	M53
	DCR	A
	JZ	M54
	DCR	A
	JZ	M55
	DCR	A
	JZ	M56
	DCR	A
	JZ	M57
	DCR	A
	JZ	M58
M5F:	INR	H
	INR	H
	POP	D
	DCR	C
	JNZ	M59
	POP	H
	PUSH	D
	LXI	D,-16
	DAD	D
	POP	D
	DCR	B
	JNZ	M5B
	XRA	A
	STA	LPOINT
	LHLD	LEVLS
	XCHG
	LXI	H,OLEVEL
	MVI	B,10H
M5D:	MVI	C,10H
M5C:	CALL	M51
	MOV	M,A
	INX	H
	DCR	C
	JNZ	M5C
	DCR	B
	JNZ	M5D
	RET
M51:	LDA	LPOINT
	ANA	A
	LDAX	D
	JNZ	M5E
	ANI	0F0H
	RRC
	RRC
	RRC
	RRC
	PUSH	PSW
	MVI	A,01H
	STA	LPOINT
	POP	PSW
	RET
M52:	LXI	D,BOLDRP
	MVI	A,01H
	STA	WBOLD
M60:	CALL	COPY
	JMP	M5F
M53:	LXI	D,BABCHP
	LDA	WBABCH
	INR	A
	STA	WBABCH
	JMP	M60
M54:	LXI	D,MINAP
	LDA	WMINA
	INR	A
	STA	WMINA
	JMP	M60
M55:	LXI	D,KAMENP
	JMP	M60
M56:	LXI	D,ALMAZP
	JMP	M60
M57:	LXI	D,STENP
	JMP	M60
M58:	LXI	D,ZEMLAP
	JMP	M60
M5E:	ANI	0FH
	PUSH	PSW
	XRA	A
	STA	LPOINT
	POP	PSW
	INX	D
	RET
M1E:	PUSH	H
	PUSH	D
	PUSH	B
	CALL	M62
	MOV	A,M
	POP	B
	POP	D
	POP	H
	RET
M2D:	PUSH	H
	PUSH	PSW
	PUSH	D
	PUSH	B
	CALL	M62
	POP	B
	MOV	M,B
	POP	D
	POP	PSW
	POP	H
	RET
M20:	MOV	B,A
	ANI	0F0H
	RRC
	RRC
	RRC
	RRC
	INR	A
	LXI	H,VIDEO
	LXI	D,-16
M64:	DCR	A
	JZ	M63
	DAD	D
	JMP	M64
M63:	MOV	A,B
	ANI	0FH
	INR	A
M65:	DCR	A
	RZ
	INR	H
	INR	H
	JMP	M65
M62:	LXI	H,OLEVEL
	MOV	B,A
	LXI	D,16
	ANI	0F0H
	RRC
	RRC
	RRC
	RRC
M68:	ANA	A
	JZ	M67
	DAD	D
	DCR	A
	JMP	M68
M67:	MOV	A,B
	ANI	0FH
	INR	A
M69:	DCR	A
	RZ
	INX	H
	JMP	M69
M41:	MOV	A,B
	DCR	A
	JZ	M6A
	DCR	A
	JZ	M6B
	DCR	A
	JZ	M6C
	MOV	A,C
	ANI	0F0H
	CPI	0F0H
	JZ	M6D
	MVI	B,10H
M6E:	XRA	A
	RET
M6D:	MVI	A,01H
	ANA	A
	RET
M6A:	MOV	A,C
	ANI	0FH
	JZ	M6D
	MVI	B,0FFH
	JMP	M6E
M6B:	MOV	A,C
	ANI	0FH
	CPI	0FH
	JZ	M6D
	MVI	B,01H
	JMP	M6E
M6C:	MOV	A,C
	ANI	0F0H
	JZ	M6D
	MVI	B,0F0H
	JMP	M6E
LEVS:	LHLD	TLEVLS
	LXI	D,-80H
	DAD	D
	LXI	D,80H
	LDA	WLEVL
M72:	DAD	D
	DCR	A
	JNZ	M72
	SHLD	LEVLS
	RET
M23:	MVI	B,16
M2310:	LDAX	D
	MOV	M,A
	INX	D
	INR	H
	LDAX	D
	MOV	M,A
	INX	D
	DCR	H
	DCR	L
	DCR	B
	JNZ	M2310
	RET
MARKP:	DW 0C003H,0C003H,0C003H,0C003H,0C003H,0C003H,-1,-1
	DW -1,-1,0C003H,0C003H,0C003H,0C003H,0C003H,0C003H
INIT:	EQU	0120H
SCR0:	EQU	0189H
SCR2:	EQU	018CH
PRINTC:	EQU	0129H
INKEY:	EQU	013BH
OLEVEL:	EQU	7D00H
FILE:	EQU	1600H
BOLDRP:	EQU	FILE
BABCHP:	EQU	FILE+360H
MINAP:	EQU	FILE+420H
KAMENP:	EQU	FILE+4E0H
ALMAZP:	EQU	FILE+3C0H
STENP:	EQU	FILE+540H
ZEMLAP:	EQU	FILE+480H
PUSTP:	EQU	60H
VIDEO:	EQU	0A0FFH
