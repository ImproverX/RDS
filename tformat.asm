	ORG	100H	JMP	STARTAREA:	EQU	2100HMBUF:	EQU	4000HPRINTC:	PUSH	H	PUSH	D	PUSH	B	PUSH	PSW	MOV	E,C	MVI	C,2	CALL	5	POP	PSW	POP	B	POP	D	POP	H	RETKEY:	JMP	0HEXOUT:	PUSH	PSW	RRC	RRC	RRC	RRC	CALL	HEX10	POP	PSWHEX10:	ANI	15	CPI	10	JC	$+5	ADI	7	ADI	30H	MOV	C,A	JMP	PRINTCPRINT:	MOV	A,M	ANA	A	RZ	INX	H	PUSH	B	MOV	C,A	CALL	PRINTC	POP	B	JMP	PRINTSTRA:	DB 12,27,'/',27,'a (c) Test & Format V1.00     ' DB 'Copyright (c) 1994 by Вьюнов В.А..',10,0STRCUR:	DB 27,'Y'YY:	DB '  ',0STRM:	DB 'F1-Форматирование  F2-Расположение секторов',0	DB 'F3-Тестирование    F4-Смена границы',0	DB 'F5-$$$             F6-Повторение при ошибке',0	DB 'F7-Смена диска     F10-Выход в ДОС',0STRM0:	DB 27,'Y#',42H,' Меню ',27,'Y(1' DB ' Сектора ',24,' Диск ',24,' Повторы ' DB 27,'Y(O',' Граница ',0STRPR:	DB 27,'Y)1',0 DB 'с ',0,' по ',0,' дор.',0STRPR1:	DB 27,'Y)O',0STRB:	DB 12,'До свидания !!!',0STR2:	DB 27,'Y,> Уверены ?',0STR3:	DB 27,'Y,>Дорожка ',0STR4:	DB 27,'Y,F',0STR5:	DB 27,'Y-A',0STR6:	DB 27,'Y.<',0STR7:	DB 7,7,7,' Конец работы',0STR8:	DB	'Форматирование',0STR9:	DB	'    Чтение    ',0STR10:	DB	'    Запись    ',0STR11:	DB 27,'Y08Плохих секторов - ',0STR12:	DB	'  Прерывание  ',7,0STR13:	DB 27,'Y1&Плохой сектор:П<р>опустить,<П>овторить или' DB ' <И>гнорировать ?',0RLINE:	DB	0VERIFY:	DB	0WREP:	DB	3POV:	DB	1DISK:	DB	0START:	LXI	SP,0	LHLD	6	LXI	D,9	DAD	D	SHLD	KEY+1	LXI	H,STRA	CALL	PRINT	MVI	B,80	MVI	C,'■'	CALL	DUBPRN	CALL	MWIN	CALL	SYSBEGIN:	MVI	C,11	CALL	PRINTCBEG10:	CALL	KEY	CPI	1	JZ	RASSEC	CPI	3	JZ	GRAN	CPI	0BEH	JZ	EXIT	ANA	A	JZ	FORM	CPI	2	JZ	TEST	CPI	0BDH	JZ	WPOVT	CPI	0B0H	JZ	CHDSK	JMP	BEG10CHDSK:	LXI	H,DISK	INR	M	MOV	A,M	ANI	1	MOV	M,A	CALL	PARAM	JMP	BEGINWPOVT:	LXI	H,POV	INR	M	MOV	A,M	CPI	4	JC	$+5	XRA	A	MOV	M,A	LXI	H,POPTAB	ADD	L	MOV	L,A	JNC	$+4	INR	H	MOV	A,M	STA	WREP	CALL	PARAM	JMP	BEGINTEST:	MVI	A,-1	JMP	FORM+1FORM:	XRA	A	STA	VERIFY	LXI	H,STR2	CALL	PRINT	CALL	KEY	ANI	7FH	CPI	60H	JC	$+5	SUI	20H	CPI	'D'	JNZ	BEGIN	LDA	FIRTRK	STA	TRACK	OUT	1AH	CALL	RESET	LXI	H,1A0CH	LXI	D,1002H	MVI	A,1	CALL	WINDOW	LXI	H,STR3	CALL	PRINT	CALL	SEARCH	LXI	H,0	SHLD	WERRFORM20:	CALL	DOR	IN	1	ANI	40H	JZ	FORM22	LXI	H,TRACK	INR	M	LDA	LSTTRK	CMP	M	JNC	FORM20	LXI	H,STR6	CALL	PRINT	LXI	H,STR7	CALL	PRINTFORM21:	LXI	H,STR11	CALL	PRINT	LHLD	WERR	CALL	PRINTH	JMP	BEGINFORM22:	LXI	H,STR6	CALL	PRINT	LXI	H,STR12	CALL	PRINT	JMP	FORM21PRINTH:	MOV	A,H	CALL	HEXOUT	MOV	A,L	JMP	HEXOUTSEARCH:	CALL	POWER	LDA	TRACK	ANA	A	RAR	OUT	18H	MVI	A,18H	JMP	COMANDDOR:	LXI	H,STR4	CALL	PRINT	LDA	TRACK	CALL	HEXOUT	LXI	H,STR5	CALL	PRINT	LXI	B,52EH	CALL	DUBPRN	LDA	VERIFY	ANA	A	JZ	DOR10	LHLD	WERR	PUSH	H	CALL	RDOR	POP	H	SHLD	WERRDOR10:	CALL	FDOR	LDA	VERIFY	ANA	A	JZ	DOR12	CALL	WDORDOR12: 	CALL	RDOR	LDA	TRACK	RRC	RNC	MVI	A,58H	CALL	COMAND	RETFDOR:	LXI	H,STR6	CALL	PRINT	LXI	H,STR8	CALL	PRINT	LXI	H,STR5	CALL	PRINT	LXI	B,504H	CALL	DUBPRN	DI	CALL	FSYS	;ET	CALL	POWER	LXI	H,AREA	LXI	D,8102H	MVI	A,0F4H	OUT	1BHFDOR10:	IN	1BH	RRC	JNC	FDOR10FDOR11:	IN	1BH	ANA	E	JZ	FDOR11	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR11	INR	HFDOR12:	IN	1BH	ANA	E	JZ	FDOR12	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR12	INR	HFDOR13:	IN	1BH	ANA	E	JZ	FDOR13	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR13	INR	HFDOR14:	IN	1BH	ANA	E	JZ	FDOR14	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR14	INR	HFDOR15:	IN	1BH	ANA	E	JZ	FDOR15	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR15	INR	HFDOR16:	IN	1BH	ANA	E	JZ	FDOR16	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR16	INR	HFDOR17:	IN	1BH	ANA	E	JZ	FDOR17	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR17	INR	HFDOR18:	IN	1BH	ANA	E	JZ	FDOR18	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR18	INR	HFDOR19:	IN	1BH	ANA	E	JZ	FDOR19	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR19	INR	HFDOR20:	IN	1BH	ANA	E	JZ	FDOR20	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR20	INR	HFDOR21:	IN	1BH	ANA	E	JZ	FDOR21	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR21	INR	HFDOR22:	IN	1BH	ANA	E	JZ	FDOR22	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR22	INR	HFDOR23:	IN	1BH	ANA	E	JZ	FDOR23	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR23	INR	HFDOR24:	IN	1BH	ANA	E	JZ	FDOR24	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR24	INR	HFDOR25:	IN	1BH	ANA	E	JZ	FDOR25	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR25	INR	HFDOR26:	IN	1BH	ANA	E	JZ	FDOR26	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR26	INR	HFDOR27:	IN	1BH	ANA	E	JZ	FDOR27	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR27	INR	HFDOR28:	IN	1BH	ANA	E	JZ	FDOR28	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR28	INR	HFDOR29:	IN	1BH	ANA	E	JZ	FDOR29	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR29	INR	HFDOR30:	IN	1BH	ANA	E	JZ	FDOR30	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR30	INR	HFDOR31:	IN	1BH	ANA	E	JZ	FDOR31	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR31	INR	HFDOR32:	IN	1BH	ANA	E	JZ	FDOR32	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR32	INR	HFDOR33:	IN	1BH	ANA	E	JZ	FDOR33	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR33	INR	HFDOR34:	IN	1BH	ANA	E	JZ	FDOR34	MOV	A,M	OUT	18H	INR	L	JNZ	FDOR34	INR	HFDOR40:	IN	1BH	XRA	D	JZ	FDOR40	RRC	MOV	A,M	OUT	18H	INX	H	JNC	FDOR40	IN	1BH	ANI	0DDH	STA	ERROR	LDA	PORT1C	OUT	1CH	RETRDOR:	LXI	H,MBUF	SHLD	DMA	LXI	H,STR6	CALL	PRINT	LXI	H,STR9	CALL	PRINT	LXI	H,200DH	CALL	VCSET	MVI	B,5RDOR10:	PUSH	B	MVI	A,6	SUB	B	OUT	19H	CALL	FISRD	JZ	RDOR12	LHLD	WERR	INX	H	SHLD	WERR	MVI	C,'?'	JMP	RDOR14RDOR12:	MVI	C,'#'RDOR14:	LHLD	YY	INR	H	SHLD	YY	LXI	H,STRCUR	CALL	PRINT	CALL	PRINTC	POP	B	LHLD	DMA	LXI	D,400H	DAD	D	SHLD	DMA	DCR	B	JNZ	RDOR10	RETWDOR:	LXI	H,MBUF	SHLD	DMA	LXI	H,STR6	CALL	PRINT	LXI	H,STR10	CALL	PRINT	LXI	H,200DH	CALL	VCSET	MVI	B,5WDOR10:	PUSH	B	MVI	A,6	SUB	B	OUT	19H	CALL	FISWR	JZ	WDOR12	MVI	C,'?'	JMP	WDOR14WDOR12:	MVI	C,'&'WDOR14:	LHLD	YY	INR	H	SHLD	YY	LXI	H,STRCUR	CALL	PRINT	CALL	PRINTC	POP	B	LHLD	DMA	LXI	D,400H	DAD	D	SHLD	DMA	DCR	B	JNZ	WDOR10	RETFSYS:	LXI	H,SECTAB	LDA	SKOD	MOV	B,A	ADD	A	ADD	A	ADD	B	MOV	C,A	MVI	B,0	DAD	B	LXI	D,AREA+172	XCHG	MVI	B,5FSYS10:	LDA	TRACK	ANA	A	RAR	MOV	M,A	INX	H	MVI	A,0	ACI	0	MOV	M,A	INX	H	LDAX	D	MOV	M,A	INX	D	PUSH	B	LXI	B,1212	DAD	B	POP	B	DCR	B	JNZ	FSYS10	RETSYS:	LXI	H,AREA	SHLD	COUNT	MVI	A,4EH	LXI	D,80	CALL	FILL	LXI	D,12	XRA	A	CALL	FILL	LXI	D,3	MVI	A,0F6H	CALL	FILL	MVI	A,0FCH	LXI	D,1	CALL	FILL	MVI	B,5SYS10:	LXI	D,60	MVI	A,4EH	CALL	FILL	LXI	D,12	XRA	A	CALL	FILL	LXI	D,3	MVI	A,0F5H	CALL	FILL	LXI	D,1	MVI	A,0FEH	CALL	FILL	XRA	A	LXI	D,3	CALL	FILL	MVI	A,3	LXI	D,1	CALL	FILL	LXI	D,1	MVI	A,0F7H	CALL	FILL	LXI	D,22	MVI	A,4EH	CALL	FILL	LXI	D,12	XRA	A	CALL	FILL	LXI	D,3	MVI	A,0F5H	CALL	FILL	LXI	D,1	MVI	A,0FBH	CALL	FILL	LXI	D,1024	MVI	A,0E5H	CALL	FILL	LXI	D,1	MVI	A,0F7H	CALL	FILL	LXI	D,70	MVI	A,4EH	CALL	FILL	DCR	B	JNZ	SYS10	LXI	D,1502	MVI	A,4EH	CALL	FILL	RETFILL:	LHLD	COUNT	MOV	C,AFILL10:	MOV	M,C	INX	H	DCX	D	MOV	A,D	ORA	E	JNZ	FILL10	SHLD	COUNT	RETEXIT:	LXI	H,STRB	CALL	PRINT	JMP	0RASSEC:	LXI	H,SKOD	INR	M	MOV	A,M	CPI	5	JC	$+5	MVI	M,0	CALL	PARAM	JMP	BEGINGRAN:	LXI	H,STRPR1	CALL	PRINT	LXI	H,FIRTRK	CALL	IN8	LXI	B,618H	CALL	DUBPRNGRAN10:	LXI	H,LSTTRK	CALL	IN8	MOV	A,M	LXI	H,FIRTRK	CMP	M	JNC	GRAN12	MVI	C,7	CALL	PRINTC	JMP	GRAN10GRAN12:	CALL	PARAM	JMP	BEGININ8:	PUSH	H	CALL	KEY	POP	H	CPI	13	JZ	IN899	CPI	30H	JC	IN8	CPI	3AH	JC	IN810	CPI	'G'	JNC	IN8	CPI	'A'	JC	IN8	SUI	7IN810:	SUI	30H	MOV	B,A	MOV	A,M	ANI	15	RRC	RRC	RRC	RRC	ORA	B	MOV	M,A	CALL	BACK	MOV	A,M	CALL	HEXOUT	CALL	BACK	JMP	IN8IN899:	MOV	A,M	CPI	0A6H	RC	MVI	C,7	CALL	PRINTC	JMP	IN8MWIN:	LXI	H,0F03H	LXI	D,2B06H	XRA	A	CALL	WINDOW	LXI	H,1004H	LXI	D,STRM	MVI	B,4	CALL	WPRINT	MVI	B,2BH	MVI	C,'■'	CALL	DUBPRN	LXI	H,STRM0	CALL	PRINT	CALL	PARAM	RETPARAM:	LXI	H,STRPR	CALL	PRINT	INX	H	PUSH	H	LDA	SKOD	MOV	B,A	ADD	A	ADD	A	ADD	B	MOV	C,A	MVI	B,0	LXI	H,SECTAB	DAD	B	MVI	B,5PAR10:	MOV	A,M	ADI	30H	MOV	C,A	INX	H	CALL	PRINTC	DCR	B	JZ	PAR12	MVI	C,'-'	CALL	PRINTC	JMP	PAR10PAR12:	LXI	B,0318H	CALL	DUBPRN	LDA	DISK	ADI	41H	MOV	C,A	CALL	PRINTC	MVI	C,':'	CALL	PRINTC	LXI	B,618H	CALL	DUBPRN	LDA	WREP	CALL	HEXOUT	MVI	C,'р'	CALL	PRINTC	LXI	B,418H	CALL	DUBPRN	POP	H	CALL	PRINT	INX	H	LDA	FIRTRK	CALL	HEXOUT	CALL	PRINT	INX	H	LDA	LSTTRK	CALL	HEXOUT	JMP	PRINTDUBPRN:	CALL	PRINTC	DCR	B	JNZ	DUBPRN	RETWPRINT:	PUSH	D	PUSH	B	CALL	VCSET	POP	B	POP	HWPRN10:	CALL	PRINT	INX	H	PUSH	H	LHLD	YY	INR	L	SHLD	YY	LXI	H,STRCUR	CALL	PRINT	POP	H	DCR	B	JNZ	WPRN10	RETWINDOW:	PUSH	D	STA	RLINE	CALL	VCSET	POP	D	CALL	HRLINE	CALL	VDLINE	CALL	HLLINEVULINE:	MVI	C,5	CALL	PRINTL	CALL	VULN20	MOV	B,EVULN10:	MVI	C,3	CALL	PRINTL	CALL	VULN20	DCR	B	JNZ	VULN10	RETVULN20:	CALL	BACK	MVI	C,19H	JMP	PRINTCHRLINE:	MVI	C,0	CALL	PRINTL	MOV	B,D	MVI	C,1HRLN10:	CALL	PRINTL	DCR	B	JNZ	HRLN10	MVI	C,2	CALL	PRINTL	CALL	BACK	MVI	C,1AH	JMP	PRINTCVDLINE:	MOV	B,EVDLN10:	MVI	C,3	CALL	PRINTL	CALL	BACK	MVI	C,1AH	CALL	PRINTC	DCR	B	JNZ	VDLN10	MVI	C,4	CALL	PRINTL	CALL	BACK	JMP	BACKHLLINE:	MOV	B,DHLLN10:	MVI	C,1	CALL	PRINTL	CALL	BACK	CALL	BACK	DCR	B	JNZ	HLLN10	RETBACK:	MVI	C,8	JMP	PRINTCVCSET:	LXI	D,2020H	DAD	D	SHLD	YY	LXI	H,STRCUR	JMP	PRINTPRINTL:	LXI	H,LTAB	PUSH	B	MVI	B,0	LDA	RLINE	DAD	B	LXI	B,6	ANA	A	JZ	$+4	DAD	B	MOV	A,M	MOV	C,A	CALL	PRINTC	POP	B	RETLTAB:	DB '≥²▀┼▄≤'	DB '╙■▐┐╘░'SECTAB:	DB 1,2,3,4,5	DB 1,4,2,5,3	DB 1,3,5,2,4	DB 1,5,4,3,2	DB 1,5,2,4,3POPTAB:	DB 0,3,10,25SKOD:	DB	2FIRTRK:	DB	0LSTTRK:	DB	165COUNT:	DW	0WOPER:	DB	0FISRD:	LDA	WREP	STA	WOPERFSRD00:	DI	CALL	POWER	LXI	H,FSRD12	PUSH	H	LHLD	DMA	MVI	A,80H	CALL	KOMANDFSRD10:	IN	1BH	RRC	RNC	RRC	JNC	FSRD10	IN	18H	MOV	M,A	INX	H	JMP	FSRD10FSRD12:	CALL	WAIT	LDA	PORT1C	OUT	1CH	IN	1BH	ANI	0DDH	STA	ERROR	EI	RZ	LXI	H,WOPER	DCR	M	JP	FSRD00	LXI	H,FISRD	JMP	FSWR20FISWR:	LDA	WREP	STA	WOPERFSWR00:	DI	CALL	POWER	LHLD	DMA	XCHG	MVI	C,2	MVI	A,0A0H	CALL	KOMANDFSWR10:	IN	1BH	ANA	C	JZ	FSWR10	LDAX	D	OUT	18H	INR	E	JNZ	FSWR10	INR	DFSWR12:	IN	1BH	ANA	C	JZ	FSWR12	LDAX	D	OUT	18H	INR	E	JNZ	FSWR12	INR	DFSWR14:	IN	1BH	ANA	C	JZ	FSWR14	LDAX	D	OUT	18H	INR	E	JNZ	FSWR14	INR	DFSWR16:	IN	1BH	ANA	C	JZ	FSWR16	LDAX	D	OUT	18H	INR	E	JNZ	FSWR16	CALL	WAIT	LDA	PORT1C	OUT	1CH	IN	1BH	ANI	0DDH	STA	ERROR	EI	RZ	LXI	H,WOPER	DCR	M	JP	FSWR00	LXI	H,FISWRFSWR20:	PUSH	H	LXI	H,STR13	CALL	PRINT	POP	HFSWR21:	PUSH	H	CALL	KEY	POP	H	ANI	7FH	CPI	5FH	JC	$+5	SUI	20H	CPI	'I'	RZ	CPI	'P'	JZ	FSWR22	CPI	'R'	JNZ	FSWR21	LDA	ERROR	ANA	A	EI	RETFSWR22:	PCHLPORT1C:	DB	34HPOWER:	CALL	MOTOR	MVI	A,0D0H	JMP	COMANDRESET:	CALL	MOTOR	XRA	A	CALL	COMAND	MVI	B,80REST10:	CALL	WAIT	DCR	B	JNZ	REST10	RETMOTOR:	LDA	DISK	ANI	3	ORI	30H	STA	PORT1C	MVI	H,4	LDA	TRACK	ANI	1	JZ	$+5	MVI	H,0	LDA	PORT1C	ORA	H	STA	PORT1CMOTR10:	LDA	PORT1C	OUT	1CH	IN	1BH	RLC	RNC	JMP	MOTR10COMAND:	OUT	1BH	CALL	WAITCOM10:	LDA	PORT1C	OUT	1CH	IN	1BH	RRC	JC	COM10	CALL	WAIT	RETKOMAND:	OUT	1BHKOM10:	IN	1BH	RRC	JNC	KOM10	RETWAIT:	MVI	A,80H	DCR	A	JNZ	$-1	RETTRACK:	DB	0SECT:	DB	0ERROR:	DB	0FTRACK:	DB	0DMA:	DW	0WERR:	DW	0