	ORG	100H
	JMP	START
MENPNT:	DB	0
COM0:	DB	0
	DS	63
COM1:	DB	0
	DS	63
COM2:	DB	0
	DS	63
COM3:	DB	0
	DS	63
COM4:	DB	0
	DS	63
COM5:	DB	0
	DS	63
START:	LXI	SP,0
	CALL	REZID
	LXI	H,STRA
	CALL	PRINT
	MVI	C,'■'
	MVI	B,64
	CALL	DUBPRN
	MVI	C,10
	CALL	PRINTC
	CALL	GTDSPB
	CALL	GETXY
	LHLD	XY
	SHLD	MENUXY
	CALL	PRMENU
	LDA	4
	ANI	15
	ADI	41H
	MOV	C,A
	CALL	PRINTC
	MVI	C,'>'
	CALL	PRINTC
	MVI	C,16H
	CALL	PRINTC
	CALL	GETXY
	SHLD	CURCCP
	SHLD	BCRCCP
	LXI	H,CCPBUF
	SHLD	CCPPNT
BEGIN:	CALL	PRPUNI
	CALL	CCPRES
BEG10:	CALL	KEY
	CPI	27
	JZ	STIR
	CPI	3
	JZ	EXIT
	CPI	13
	JZ	RUN
	CPI	10
	JZ	CHANG
	CPI	19H
	JZ	UP
	CPI	1AH
	JZ	DOWN
	CPI	8
	JZ	ZAB
	CPI	7FH
	JZ	ZAB
	CPI	20H
	JC	BEGIN
	MOV	C,A
	CALL	CCPOUT
	JMP	BEGIN
STIR:	LHLD	BCRCCP
	SHLD	CURCCP
	LXI	H,CCPBUF
	SHLD	CCPPNT
	CALL	CCPRES
	MVI	C,16H
	CALL	PRINTC
	JMP	BEGIN
EXIT:	CALL	SAVEPR
	MVI	E,0
	LXI	B,0C80H
	CALL	5
	JMP	0
REZID:	MVI	E,-1
	LXI	B,0C80H
	CALL	5
	ANA	A
	RNZ
	LXI	D,REZFIL
	LXI	B,0B80H
	JMP	5
REZFIL:	DB	3,'TASM    COM'
SAVEPR:	LXI	H,REZFIL
	LXI	D,5CH
	PUSH	D
	MVI	B,12
	CALL	COPY
	CALL	CLEAR
	POP	D
	MVI	C,15
	CALL	5
	LXI	D,100H
	MVI	B,4
SAVE10:	PUSH	B
	PUSH	D
	MVI	C,26
	CALL	5
	LXI	D,5CH
	MVI	C,21
	CALL	5
	POP	D
	LXI	H,128
	DAD	D
	XCHG
	POP	B
	DCR	B
	JNZ	SAVE10
	RET
COPY:	MOV	A,M
	STAX	D
	INX	H
	INX	D
	DCR	B
	JNZ	COPY
	RET
CLEAR:	LXI	H,68H
	LXI	B,1800H
FILL:	MOV	M,C
	INX	H
	DCR	B
	JNZ	FILL
	RET
RUN:	CALL	SAVEPR
	LHLD	CURCCP
	MOV	A,L
	CPI	2
	JZ	RUN20
	LHLD	CCPPNT
	MVI	M,0
	LXI	H,CCPBUF
RUN02:	LXI	D,80H
	CALL	RUN10
	XCHG
	MVI	M,13
	INX	H
	MVI	M,10
	INX	H
	MVI	M,1AH
	MVI	C,19H
	CALL	PRINTC
	LXI	B,0A80H
	CALL	5
	JMP	0
RUN20:	LDA	MENPNT
	MOV	L,A
	MVI	H,0
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	LXI	D,COM0
	DAD	D
	JMP	RUN02
CHANG:	LHLD	CCPPNT
	MVI	M,0
	LDA	MENPNT
	MOV	L,A
	MVI	H,0
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	LXI	D,COM0
	DAD	D
	LXI	D,CCPBUF
	XCHG
	CALL	RUN10
	CALL	PRMENU
	JMP	BEGIN
RUN10:	MOV	A,M
	STAX	D
	ANA	A
	RZ
	INX	H
	INX	D
	JMP	RUN10
UP:	CALL	PRPUNN
	LXI	H,MENPNT
	DCR	M
	JP	BEGIN
	MVI	M,5
	JMP	BEGIN
DOWN:	CALL	PRPUNN
	LXI	H,MENPNT
	INR	M
	MOV	A,M
	CPI	6
	JC	BEGIN
	MVI	M,0
	JMP	BEGIN
ZAB:	LHLD	CURCCP
	MOV	A,L
	CPI	2
	JZ	BEG10
	DCR	L
	SHLD	CURCCP
	LHLD	CCPPNT
	DCX	H
	SHLD	CCPPNT
	MVI	C,8
	CALL	PRINTC
	MVI	C,20H
	CALL	PRINTC
	MVI	C,8
	CALL	PRINTC
	JMP	BEG10
PRMENU:	LXI	D,1
	CALL	PRMN10
	INR	D
	MOV	A,D
	CPI	6
	JC	PRMENU+3
	RET
PRPUNN:	MVI	E,1
	JMP	PRPUNI+2
PRPUNI:	MVI	E,0
	LDA	MENPNT
	MOV	D,A
PRMN10:	MOV	A,E
	DCR	A
	CZ	PRMN12
	LHLD	MENUXY
	MOV	A,D
	ADD	A
	MOV	C,A
	ADD	A
	ADD	A
	ADD	C
	MOV	C,A
	MOV	A,H
	SUB	C
	MOV	H,A
	CALL	SETCUR
	MOV	L,D
	MVI	H,0
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	LXI	B,STRM0
	DAD	B
	CALL	PRINT
	MOV	A,E
	DCR	A
	CZ	PRMN13
	MVI	C,'╜'
	CALL	PRINTC
	MOV	L,D
	MVI	H,0
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	LXI	B,COM0
	DAD	B
	CALL	PRINT
	MVI	C,16H
	CALL	PRINTC
	MVI	C,10
	JMP	PRINTC
PRMN13:	LXI	H,STRNOR
	JMP	PRINT
PRMN12:	LXI	H,STRINV
	JMP	PRINT
GTDSPB:	DI
	LDA	15
	OUT	10H
	LHLD	0A002H
	LXI	D,1EH
	DAD	D
	MOV	E,M
	INX	H
	MOV	D,M
	XCHG
	SHLD	DSPBAS
	LDA	3CH
	OUT	10H
	EI
	RET
GETXY:	DI
	LDA	15
	OUT	10H
	LHLD	DSPBAS
	INX	H
	MOV	E,M
	INX	H
	MOV	D,M
	XCHG
	SHLD	XY
	LDA	3CH
	OUT	10H
	EI
	RET
CCPRES:	LHLD	CURCCP
	JMP	SETCUR
CCPOUT:	LHLD	CURCCP
	MOV	A,L
	CPI	66
	JNC	CCPO10
	INR	L
	SHLD	CURCCP
	CALL	PRINTC
	LHLD	CCPPNT
	MOV	M,C
	INX	H
	SHLD	CCPPNT
	RET
CCPO10:	MVI	C,7
	JMP	PRINTC
SETCUR:	PUSH	D
	XCHG
	DI
	LDA	15
	OUT	10H
	LHLD	DSPBAS
	INX	H
	MOV	M,E
	INX	H
	MOV	M,D
	LDA	3CH
	OUT	10H
	EI
	POP	D
	RET
KEY:	PUSH	H
	PUSH	D
	PUSH	B
	LXI	H,FRBIOS
	MVI	M,1
	XCHG
	LXI	B,980H
	CALL	5
	POP	B
	POP	D
	POP	H
	RET
PRINTC:	PUSH	H
	PUSH	D
	PUSH	B
	PUSH	PSW
	LXI	H,FRBIOS
	MVI	M,2
	INX	H
	MOV	M,C
	DCX	H
	XCHG
	LXI	B,980H
	CALL	5
	POP	PSW
	POP	B
	POP	D
	POP	H
	RET
PRINT:	MOV	A,M
	ANA	A
	RZ
	PUSH	B
	MOV	C,A
	CALL	PRINTC
	INX	H
	POP	B
	JMP	PRINT
DUBPRN:	CALL	PRINTC
	DCR	B
	JNZ	DUBPRN
	RET
FRBIOS:	DS	3
STRA:	DB 10,'TurboAssembler V1.0',9,'Copyright (c) 1995'
	DB	' by Вьюнов В.А.',10,0
STRM0:	DB	'РЕДАКТИРОВАНИЕ ',0
STRM1:	DB	'  ТРАНСЛЯЦИЯ   ',0
STRM2:	DB	'  КОМПОНОВКА   ',0
STRM3:	DB	'    ЗАПУСК     ',0
STRM4:	DB	'   ОТЛАДКА     ',0
STRM5:	DB	'ДОПОЛНИТЕЛЬНАЯ ',0
XY:	DW	0
MENUXY:	DW	0
CURCCP:	DW	0
DSPBAS:	DW	0
STRNOR:	DB	27,'a',0
STRINV:	DB	27,'b',0
CCPPNT:	DW	0
BCRCCP:	DW	0
CCPBUF:	DS	64
